**Sometimes one needs to use brute force if subtlety doesn't work.**

I tried "smart" ways of doing this but there were too many edge cases. After a couple hours, I went the brute force way.